\subsection{DRP-00-05: Execution of the DRP Science Payload by the DRP Execution Service}
\label{drp-00-05}

\subsubsection{Requirements}

%
DMS-REQ-0293,DMS-REQ-0294.
DMS-REQ-0302,DMS-REQ-0303,DMS-REQ-0305
%
DMS-REQ-0106,
DMS-REQ-0304,DMS-REQ-0306,DMS-REQ-0307,
% ?
DMS-REQ-0299,DMS-REQ-0298
DMS-REQ-0292,DMS-REQ-0295,

\subsubsection{Test items}

This test will check that the DRP Science Payload can be executed using the current state-of-the-art execution service provided by the LSST Data Facility.

Specifically, this will demonstrate that:

\begin{itemize}

  \item{A selection of dataset can be identified, retrieved, and processed (DMS-REQ-0293).}
  \item{Selected datasets can be processed through selected Data Release Production science payload using a prototype of the production system. Processed results will be recorded (DMS-REQ-0294).}
  \item{The software can orchestrate execution of the pipelines on LSST-VC compute nodes (DMS-REQ-0302).}
  \item{The software can monitor the status of pipeline execution (DMS-REQ-0303).}
  \item{The sequence of the pipeline tasks can be defined without recompilation for the execution (DMS-REQ-0305).}

  \item{The provenance and metadata of the data products, such as the list of input images for the coadded images and how to recreate the data, shall be stored (DMS-REQ-0106).}
  \item{The software can detect faults in pipeline execution and recover when possible (DMS-REQ-0304).}
  \item{The software can define, override components of, and verify the suitability of the configuration for a task. (DMS-REQ-0306).}
  \item{The software can enable applications process every record in a table meeting
user-specified criteria exactly once. (DMS-REQ-0307).}
% Seems more for the DAC?
  \item{The software can ingest data products into the Science Data Archive (DMS-REQ-0299).}
  \item{The software can list and retrieve image, file, and catalog data products and their associated metadata and provenance (DMS-REQ-0298).}
  \item{All IDs shall be unique across data releases databases (DMS-REQ-0292).}
  \item{The software can allow retrieval by productions or science users of datasets from any Facility without requiring reconfiguration (DMS-REQ-0295).}

\end{itemize}

\subsubsection{Intercase dependencies}

\begin{itemize}

  \item{\hyperref[drp-00-00]{DRP-00-00}}

\end{itemize}

\subsubsection{Environmental needs}

\paragraph{Hardware}

This test case shall be executed on a system at NCSA.
We assume that this system will be the LSST Verification Cluster (LSST-VC),
with access to the GPFS shared filesystem and an Oracle database system.

\paragraph{Software}\label{sec:software}

The DESDM Framework packages 1.01 and the Release 14.0 of the DM Software Stack will be pre-installed. The Python 2 version will be used.
The ticket branch \texttt{tickets/DM-12291} of the Software Stack packages \texttt{meas{\_}base}, \texttt{pipe{\_}tasks}, and \texttt{obs{\_}subaru} will be used to change the patch ID naming convention.
This is due to issues of having commas in the filenames and data IDs, as discussed in \jira{RFC-361}; the solution has been agreed in \jira{RFC-365} for future implementation in \jira{DM-11874}, \jira{DM-11875}, and \jira{DM-11876}.

\subsubsection{Input specification}\label{sec:input}

At least one tract of the Hyper Suprime-Cam "RC" dataset, as defined in DMTR-31, will be used.
The calibration dataset will be the 20170105 version, as in DMTR-31.


\subsubsection{Output specification}

The output data products will be made available on a shared filesystem accessible at LSST-VC and files are managed by a prototype Data Backbone.

\subsubsection{Procedure}

\begin{enumerate}

  \item{The LSST Science Pipelines and the DESDM Framework, plugins, and integration code as described in \S\ref{sec:software}  will be installed into the GPFS filesystem at \texttt{/project/production/} on LSST-VC. The packages will be setup by the operator.}
  \item{Input raw and calibration data will be made acessible on the GPFS filesystem, and registered into the prototype Data Backbone. The input dataset selected in \S\ref{sec:input} will be tagged.}
  \item{Given the LSST Science Pipelines version, the operator will prerun the pipelines to create the full config files and schema files, which are then ingested into the prototype Data Backbone.}
  \item{The pipeline workflow definition file (wcl) version 1.01 will be downloaded; its operations- and dataset-specific inputs will be modified accordingly.}
  \item{For each tract of the input data, the corresponding wcl file will be submitted to execution on LSST-VC.}
  \item{During exeuction, the "desstat" command will be run to demonstrate the ability to check the processing status.}
  \item{When the execution finishes, the success of the execution will be verified by checking the existence of the expected output data.
  For each of the expected data products types (listed in \S\ref{drp-00-10-items})
  and each of the expected units (PVIs, coadds, etc), the data product will be
  verified to be non-empty.}
  \item{A brief summary of the execution metrics, such as the number of executions of each executable, execution time usage, etc. will be gathered and examined.}
  \item{The database will be queried to obtain the count of the files. The number will be cross-checked with the filesystem as a consistency verification.}

\end{enumerate}
