\subsection{DRP-00-05: Execution of the DRP Science Payload by the DRP Execution Service}
\label{drp-00-05}

\subsubsection{Requirements}

DMS-REQ-0106,DMS-REQ-0292,DMS-REQ-0293,DMS-REQ-0294,DMS-REQ-0302,DMS-REQ-0303,DMS-REQ-0304.

\subsubsection{Test items}

This test will check that the DRP Science Payload can be executed using the current state-of-the-art execution service provided by the LSST Data Facility.

Specifically, this will check if the following requirements are fulfilled:

\begin{itemize}
  \item{For each Coadded Image, DMS shall store: the list of input images and the pipeline parameters, including software versions, used to derive it, and a sufficient set of metadata attributes for users to re-create them in whole or in part (DMS-REQ-0106).}
  \item{To reduce the likelihood for confusion, all IDs shall be unique across databases and database versions, other than those corresponding to uniquely identifiable entities (i.e., IDs of exposures) (DMS-REQ-0292).}
  \item{A Dataset may consist of one or more pixel images, a set of records in a file or database, or any other grouping of data that are processed or produced as a logical unit. The DMS shall be able to identify and retrieve complete, consistent datasets for processing (DMS-REQ-0293).}
  \item{The DMS shall process all requested datasets until either a successful result is recorded or a permanent failure is recognized. If any dataset is processed, in part or in whole, more than once, only one of the wholly processed results will be recorded for further processing.
(DMS-REQ-0294).}
  \item{The DMS shall provide software to orchestrate execution of productions, including deploying pipelines on a computing platform (DMS-REQ-0302).}
  \item{The DMS shall provide software to monitor execution of pipelines in real time (DMS-REQ-0303).}
  \item{The DMS shall provide software to detect faults in pipeline execution and recover when possible.
(DMS-REQ-0304).}

\end{itemize}

\subsubsection{Intercase dependencies}

\begin{itemize}

  \item{\hyperref[drp-00-00]{DRP-00-00}}

\end{itemize}

\subsubsection{Environmental needs}

\paragraph{Hardware}\label{sec:hardware}

This test case shall be executed on a system at NCSA.

For Fall 2017, we assume that this system will be the LSST Verification Cluster (LSST-VC),
with access to the GPFS shared filesystem and an Oracle database system.

\paragraph{Software}\label{sec:software}
The DM Software Stack and the DESDM Framework packages will be pre-installed.

For Fall 2017, the version of the DM Software Stack will be Release 14.0, and the version of the DESDM Framework packages, plugins, and integration code will be 1.01.
The Python 2 version will be used.
The ticket branch \texttt{tickets/DM-12291} of the Software Stack packages \texttt{meas{\_}base}, \texttt{pipe{\_}tasks}, and \texttt{obs{\_}subaru} will be used to change the patch ID naming convention.
This is due to issues of having commas in the filenames and data IDs, as discussed in \jira{RFC-361}; the solution has been agreed in \jira{RFC-365} for future implementation in \jira{DM-11874}, \jira{DM-11875}, and \jira{DM-11876}.

\subsubsection{Input specification}\label{sec:input}

At least one tract of the Hyper Suprime-Cam "RC" dataset, as defined in DMTR-31, will be used.
The calibration dataset will be the 20170105 version, as in DMTR-31.


\subsubsection{Output specification}

The output data products will be made available on a shared filesystem accessible at LSST-VC and files are managed by Data Backbone.

\subsubsection{Procedure}

\paragraph{Setup}
\begin{enumerate}

  \item{The LSST Science Pipelines and the DESDM Framework, plugins, and integration code as described in \S\ref{sec:software}  will be installed and setup by the operator.}
  \begin{enumerate}
    \item{For Fall 2017, the software will be installed into the GPFS space at \texttt{/project/production/} on LSST-VC.}
  \end{enumerate}
  \item{Input raw and calibration data must exist in the Data Backbone. If not, the data will be ingested into Data Backbone.  The input dataset selected in \S\ref{sec:input} will be tagged.}
  \begin{enumerate}
    \item{For Fall 2017, the prototype Data Backbone is acessible on the GPFS filesystem on LSST-VC.}
  \end{enumerate}
  \item{Given the LSST Science Pipelines version, the operator will generate the full config files and schema files, which are then ingested into the prototype Data Backbone.}
  \item{The pipeline workflow definition file of a consistent version will be downloaded; its operations- and dataset-specific inputs will be modified accordingly.}
  \begin{enumerate}
    \item{For Fall 2017, the pipeline workflow definition file is a "wcl" file as used by the DESDM Framework Software.}
  \end{enumerate}
\end{enumerate}

\paragraph{Execution}
\begin{enumerate}
  \item{The execution for each tract of the input data in \S\ref{sec:input} will be submitted to the hardware in \S\ref{sec:hardware}.}
  \item{During exeuction, the operator will use software to demonstrate its ability to check the processing status.}
\end{enumerate}

\paragraph{Non-science QA}
\begin{enumerate}
  \item{When the execution finishes, the success of the execution will be verified by checking the existence of the expected output data.
  For each of the expected data products types (listed in \S\ref{drp-00-10-items})
  and each of the expected units (PVIs, coadds, etc), the data product will be
  verified to be non-empty.}
  \item{A brief summary of the execution metrics, such as the number of executions of each executable, execution time usage, etc. will be gathered and examined.}
  \item{The database will be queried to obtain the count of the files. The number will be cross-checked with the filesystem as a consistency verification.}
\end{enumerate}
\paragraph{First-order Science QA}
\begin{enumerate}
  \item{Production Scientist will perform first-order science quality assurance.}
\end{enumerate}
