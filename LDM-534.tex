\documentclass[DM,lsstdraft,STS,toc]{lsstdoc}
\usepackage{enumitem}
\input meta.tex

\begin{document}

\def\product{LSST Level 2 System}

\setDocCompact{true}

\title[STS for \product]{\product~Software Test Specification}

\author{John D. Swinbank}
\setDocRef{\lsstDocType-\lsstDocNum}
\setDocDate{\vcsdate}

\setDocAbstract {
This document describes the detailed test specification for the \product{}.
}

% Most recent last
\setDocChangeRecord{%
	\addtohist{1}{2017-06-30}{Initial release of draft version.}{Swinbank}
	\addtohist{2}{2017-07-03}{Updated metadata; no content changes.}{Swinbank}
    \addtohist{3}{2017-11-XX}{Updated to cover the LDM-503-2 (``HSC Reprocessing'') milestone.}{Bosch, Gelman, Petravick, Swinbank}
}

\setDocCurator{John D. Swinbank}
\setDocUpstreamLocation{\url{https://github.com/lsst/ldm-534}}
\setDocUpstreamVersion{\vcsrevision}

\maketitle

\section{Introduction}
\label{sec:intro}

This document specifies the test procedure for the \product{}.

The \product{} is the component of the LSST system which is responsible for
scientific processing leading to:

\begin{itemize}

  \item{Annual data release production;}
  \item{Periodic (re-) generation of calibration products;}
  \item{Periodic (re-) generation of templates for generating difference
  images, to be consumed in the L1 system;}
  \item{Generating QC metrics based on pipeline execution and post-processing of
  scientific data products.}

\end{itemize}

\subsection{Objectives}
\label{sec:objectives}

This document builds on the description of LSST Data Management's approach to
testing as described in \citeds{LDM-503} to describe the detailed tests that
will be performed on the \product{} as part of the verification of the DM system.

It identifies test designs, test cases and procedures for the tests, and the
pass/fail criteria for each test.

\subsection{Scope}
\label{sec:scope}

This document describes the test procedures for the following components of
the LSST system (as described in \citeds{LDM-148}):

\begin{itemize}

  \item{Annual Calibration}
  \item{Daily Calibration Update}
  \item{Data Release Production}
  \item{Periodic Calibration}
  \item{Raw Calibration}
  \item{Science Algorithms (partial)}
  \item{Science Primitives (partial)}
  \item{Template Generation}

\end{itemize}

\subsection{Applicable Documents}
\label{sec:docs}

\addtocounter{table}{-1}

\begin{tabular}[htb]{l l}
\citeds{LDM-151} & LSST DM Science Pipelines Design \\
\citeds{LDM-294} & LSST DM Organization \& Management \\
\citeds{LDM-502} & The Measurement and Verification of DM Key Performance Metrics \\
\citeds{LDM-503} & LSST DM Test Plan \\
\citeds{LSE-61}  & LSST DM Subsystem Requirements \\
\citeds{LSE-163} & LSST Data Products Definition Document \\
\citeds{LSE-180} & Level 2 Photometric Calibration for the LSST Survey \\
\end{tabular}

\subsection{References\label{sect:references}}
\renewcommand{\refname}{}
\bibliography{lsst,refs,books,refs_ads}

%\subsection{Definitions, acronyms, and abbreviations \label{sect:acronyms}} % include acronyms.tex generated by the acronyms.csh (GaiaTools)
%\input{acronyms}


%----------------------------------------------------
% TASK IDENTIFICATION - APPROACH
%----------------------------------------------------
\section{Approach}
\label{sec:approach}

The major activities to be performed are to:

\begin{itemize}

  \item{Compare the design of the Data Release Production payload as
  implemented to the requirements on the outputs of the DM Subsystem as
  defined in \citeds{LSE-63} and \citeds{LSE-163} to demonstrate that all data
  products required by the scientific community will be delivered by the
  system as built.}

  \item{Ensure that all data products included in the DRP payload design are
  correctly produced and persisted appropriately to the LSST Data Backbone
  when executing a data release production.}

  \item{Compare the design of the Calibration Products payloads as implemented
  to the requirements laid down in \citeds{LSE-63}, the overall design
  described in \citeds{LSE-180} and the inputs of the scientific pipeline
  payloads as described in \citeds{LDM-151}.}

  \item{Ensure that all data products included in the CPP payload design are
  correctly produced and persisted appropriately to the LSST Data Backbone
  and/or Calibration Database when executing a calibration products
  production.}

  \item{Compare the implementation of the Template Generation payloads to the
  inputs required by the Alert Production payload as defined in
  \citeds{LDM-151}.}

  \item{Ensure that all data products required by the L1 system are correctly
  produced and persisted appropriately to the LSST Data Backbone when
  executing a template generation production.}

  \item{Demonstrate that QC metrics are properly calculated and transmitted
  during the execution all L2 production types.}

  \item{Demonstrate that post-processing QC analysis of data products can be
  used to identify and report on failures or anomalies in the processing.}

\end{itemize}

\subsection{Tasks and criteria}
\label{sec:tasks}

The following are the major items under test:

\begin{itemize}

  \item{Science payloads capable of generating all LSST Level 2 data
  products;}

  \item{Calibration products payloads, run at a variety of cadences, to
  generate all calibration products required in the generation of LSST Level 1
  and 2 data products;}

  \item{Template generation payloads capable of generating deep templates
  required for difference imaging in the context of the LSST Level 1 system.}

\end{itemize}

\subsection{Features to be tested}
\label{sec:feat2test}

\begin{itemize}

  \item{Execution of payloads described in \S\ref{sec:tasks};}
  \item{Persistence of all required data products.}

\end{itemize}


\subsection{Features not to be tested}
\label{sec:featnot2test}

This version of the \product{} test specification addresses only the functional
requirements of the systems under test, as derived from the DM System
Requirements (\citeds{LSE-61}).

A further set of requirements which describe the scientific fidelity of the
output data products are not tested in this version of this test
specification pending flow-down to \citeds{LSE-61}.

The progress of the DM system towards satisfying the scientific requirements
on LSST's data products is tracked by means of a series of Key Performance
Metrics (KPMs) derived from high-level requirements documents (\citeds{LPM-17,
LSE-29, LSE-30}). The system being used to track KPMs and to ensure compliance
with these requirements is described in \citeds{LDM-502}.

\subsection{Pass/fail criteria}
\label{sec:passfail}

The results of all tests will be assessed using the criteria described in
\citeds{LDM-503} \S4.

Note that, when executing pipelines, tasks or individual algorithms, any
unexplained or unexpected errors or warnings appearing in the associated log
or on screen output must be described in the documentation for the system
under test. Any warning or error for which this is not the case must be filed
as a software problem report and filed with the DMCCB.

\subsection{Suspension criteria and resumption requirements}
\label{suspension}

Refer to individual test cases where applicable.

\subsection{Naming convention}

All tests are named according to the pattern prod-scope-xx-yy where:

\begin{description}[font=\normalfont\scshape]

  \item[prod]{The product code, per \citeds{LDM-294}. Relevant entries for this document are:
    \begin{description}[font=\normalfont\scshape,topsep=-1.0ex]
      \item[caldaily]{Daily CPP payload}
      \item[cppslow]{Periodic CPP payload}
      \item[cppyear]{Annual CPP payload}
      \item[tmplgen]{Template generation payload}
      \item[cppqc]{CPP QC measurement generators}
      \item[drp]{Annual mini-DRP and DRP payload}
      \item[l2qc]{L2 QC measurement generators}
      \item[cppqc]{CPP QC measurement generators}
    \end{description}
  }
  \item[scope]{The type of test being described:
    \begin{description}[font=\normalfont\scshape,topsep=-1.0ex]
      \item[acp]{Acceptance}
      \item[bck]{Backup and restore}
      \item[fun]{Functional}
      \item[ins]{Installation}
      \item[int]{Integration}
      \item[itf]{Interface}
      \item[mnt]{Maintenance}
      \item[prf]{Performance}
      \item[reg]{Regression}
      \item[ver]{Verification}
    \end{description}
  }
  \item[xx]{Test design number (in increments of 10)}
  \item[yy]{Test case number (in increments of 5)}

\end{description}

\input{specs/specs.tex}
\input{cases/cases.tex}

\end{document}
